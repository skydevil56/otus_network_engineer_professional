# Защита GRE при помощи IPsec. Защита сети DMVPN при помощи IPsec. ptpGRE/mGRE over IPsec

## Цели

1. Настроить IPsec для защиты GRE (GRE over IPsec) между офисами Москва и Санкт-Петербург
1. Настроить IPsec для защиты DMVPN сети между офисами Москва и Чокурдак, Лабытнанги

## Задание

1. Настроить IPsec* для защиты GRE (GRE over IPsec) между офисами Москва и Санкт-Петербург
1. Настроить IPsec** для защиты DMVPN сети между офисами Москва и Чокурдак, Лабытнанги
1. Все узлы в офисах в лабораторной работе должны иметь IP связность

*Аутентификация в IPsec должна быть при помощи предварительно распределенных ключей (preshared keys)
**Аутентификация в IPsec должна быть при помощи цифровых сертификатов (PKI/x509)

## Топология

![a](media/lab14_1.PNG)

## Схема для импорта в PNETlab

[Схема для импорта в PNETlab](media/otus_cource_lab13_GRE_DMVPN_pnetlab_export-20250223-163533.zip)

## Версии ПО

- PNETlab - 5.3.11
- Роутеры - Cisco IOS Software, Linux Software (I86BI_LINUX-ADVENTERPRISEK9-M), Version 15.4(2)T4
- Коммутаторы - Cisco IOS Software, Linux Software (I86BI_LINUXL2-ADVENTERPRISEK9-M), Version 15.2(CML_NIGHTLY_20150703)
- ПК - VPC

## Решение

1. Настроить IPsec для защиты GRE (GRE over IPsec) между офисами Москва и Санкт-Петербург




1. Настроить IPsec** для защиты DMVPN сети между офисами Москва и Чокурдак, Лабытнанги



## Проверка работоспособности стенда

1. Проверка GRE с шифрованием между офисами Москва и Санкт-Петербург.

      Выполним проверку доступности устройств VPC51 и VPC52 офиса Санкт-Петербург из офиса Москва.  
      Проверка будет выполняться с устройства VPC11. 

      ```



      ```

      Видим, что проверка доступности выполнена успешно.  
      Дополнительная информация о работе протокола BGP приведена в главе "Конфигурации устройств".


1. Проверка DMVPN с шифрованием между офисами Москва и Чокурдак, Лабытнанги.

      Выполним проверку доступности устройств VPC71 и VPC72 офиса Чокурдак и роутера R61 офиса Лабытнанги из офиса Москва.  
      Проверка будет выполняться с устройства VPC11.

      ```



      ```
      Видим, что проверка доступности выполнена успешно.  
      Дополнительная информация о работе DMVPN приведена в главе "Конфигурации устройств".

## Конфигурации устройств

### R13

<details>
  <summary>Конфигурация</summary>

```



```
</details>

### R14

<details>
  <summary>Конфигурация</summary>

```



```
</details>


### R52

<details>
  <summary>Конфигурация</summary>

```



```
</details>

### R61

<details>
  <summary>Конфигурация</summary>

```



```
</details>

### R71

<details>
  <summary>Конфигурация</summary>

```



```
</details>
